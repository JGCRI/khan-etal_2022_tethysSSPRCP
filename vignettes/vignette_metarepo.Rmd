---
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Meta-Reository}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
resourse_files:
  - vignettes/vignetteFigs
---

<!-------------------------->
<!-------------------------->
# Citation
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="vignetteFigs/divider.png"></p>

Khan, Z., Thompson, I., Vernon, C., 2022. A global gridded monthly water withdrawal dataset for multiple sectors from 2015 to 2100 at 0.5° resolution under a range of socioeconomic and climate scenarios. (In progress) Journal_TBD, DOI: XXXX

<!-------------------------->
<!-------------------------->
# Models Used
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="vignetteFigs/divider.png"></p>

```{r, results = 'show', eval=TRUE, echo=FALSE, warning=FALSE, error = FALSE, message = FALSE}
library(kableExtra)
data.frame(
    Model = c("Tethys"),
    Version = c("v1.3.0?"),
    Description = c("Spatiotemporal downscaling model for global water use"),
    Language = c("Python"),
    Link = c("https://jgcri.github.io/tethys/")
    ) %>% 
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```


<!-------------------------->
<!-------------------------->
# Data Inputs
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="vignetteFigs/divider.png"></p>

```{r, results = 'show', eval=TRUE, echo=FALSE, warning=FALSE, error = FALSE, message = FALSE}
library(kableExtra)
data.frame(
  Data = c("GCAM Outputs",
           "Demeter Outputs"),
  Source = c("GCAM runs",
             "Demeter runs"),
  `Used by` = c("Tethys",
                "Tethys"),
  Location = c("zenodo link",
               "zenodo link")
    ) %>% 
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```
<!-------------------------->
<!-------------------------->
# Data Outputs
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="vignetteFigs/divider.png"></p>

```{r, results = 'show', eval=TRUE, echo=FALSE, warning=FALSE, error = FALSE, message = FALSE}
library(kableExtra)
data.frame(
  Data = c("Tethys Outputs"),
  Source = c("Tethys runs"),
  `Used by` = c(""),
  Location = c("zenodo link")
    ) %>% 
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```

<!-------------------------->
<!-------------------------->
# Workflows
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="vignetteFigs/divider.png"></p>

```{r, echo=FALSE, out.width="40%", fig.align='center', fig.cap="Workflow Summary"}
knitr::include_graphics("vignetteFigs/workflow_summary.jpg")
```

# Workflow 1 - Scenarios
This dataset contains water withdrawal projections under a range of socioeconomic and climate scenarios. Combinations of five Shared Socioeconomic Pathways (SSPs 1-5) and four Representative Concentration Pathways (RCPs 2.6, 4.5, 6, and 8.5) are used. However, RCP 2.6 is not considered possible under SSP 3, and RCP 8.5 is only considered possible for SSP 5. This leaves 15 valid SSP-RCP combinations, shown in the diagram below.

Chart showing combinations

For each valid SSP-RCP combination, five General Circulation Models (GCMs) are used, with the exception of SSP 5-RCP 8.5, which only uses one (Find out why). This gives a grand total of 71 SSP-RCP-GCM combinations, which are fed into the models.

# Workflow 2 - Model Runs
(Comment on GCAM, Xanthos, Demeter)
GCAM is run for each SSP-RCP-GCM combination. The GCAM outputs are at the resolution of 32 geopolitical regions, and 235 water basins, with 5-year timesteps. The sectoral water withdrawal outputs from GCAM are the primary inputs to Tethys, which will be downscaled to the target resolution. Crop outputs from GCAM are sent to Demeter for downscaling, to be used by Tethys for the irrigation sector.

# Workflow 3 - Spatial Downscaling
Withdrawal data for each sector is downscaled spatially first, from 32 regions or 235 basins to 0.5 degree grids. Of the 259,200 possible grid cells at this resolution (360 x 720), only the 67,420 cells categorized as land are considered (since nobody is withdrawing water from the bottom of the ocean).

Different downscaling methods are used for different sectors. For spatial downscaling, the workflow is divided into three parts:

* A. Nonagricultural Sectors
* B. Livestock
* C. Irrigation

## Workflow 3A - Nonagricultural Sectors
For nonagricultural sectors (domestic, electricity, manufacturing, and mining), water withdrawal in each grid cell is assumed to be proportional to that cell’s population.
(equation, supporting files, function name)

## Workflow 3B - Livestock
Gridded global maps of livestock in six types (cattle, buffalo, sheep, goats, pigs and poultry) are used as a proxy to downscale livestock water withdrawal.

## Workflow 3C - Irrigation
Uses Demeter outputs.

# Workflow 4 - Temporal Downscaling
At this stage the data has been downscaled spatially to 0.5 degree grids, but is still in 5-year timesteps. First, linear interpolation is applied to produce annual data. Then, downscaling algorithms are applied to each sector to produce monthly data with seasonal variation.

For spatial downscaling, the workflow is divided into four parts:

* A. Livestock, Manufacturing, and Mining
* B. Domestic
* C. Electricity Generation
* D. Irrigation

## Workflow 4A - Livestock, Manufacturing, and Mining
For livestock, manufacturing, and mining, a uniform distribution is applied. The withdrawal for the year is divided between months according to the number of days.

## Workflow 4B - Domestic
Temporally downscaling domestic withdrawal is based on monthly average temperatures, and the relative withdrawals between warmest and coolest months.

## Workflow 4C - Electricity Generation
Assume water use is proportional to electricity generated. Formula based on HDD, CDD.

## Workflow 4D - Irrigation
Monthly weighted irrigation profiles based on region and crop type.

# Workflow 5 - Results

## Annual
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Total Annual Water Withdrawal by SSP-RCP-GCM"}
knitr::include_graphics("vignetteFigs/figure1.png")
```
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Global Annual Water Withdrawal by SSP-RCP-GCM and Sector"}
knitr::include_graphics("vignetteFigs/figure2.png")
```
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Global Annual Water Withdrawal by SSP-RCP-Sector, GCM: gfdl"}
knitr::include_graphics("vignetteFigs/figure3a.png")
```
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="TGlobal Annual Water Withdrawal by SSP-RCP-Sector, GCM: hadgem"}
knitr::include_graphics("vignetteFigs/figure3b.png")
```
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Global Annual Water Withdrawal by SSP-RCP-Sector, GCM: ipsl"}
knitr::include_graphics("vignetteFigs/figure3c.png")
```
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Global Annual Water Withdrawal by SSP-RCP-Sector, GCM: miroc"}
knitr::include_graphics("vignetteFigs/figure3d.png")
```
```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Global Annual Water Withdrawal by SSP-RCP-Sector, GCM: noresm"}
knitr::include_graphics("vignetteFigs/figure3e.png")
```

## Monthly

## Maps


